<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="author" content="Version 1.0 Jan 12 2022">
<title>EMEWS Tutorial</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #408080; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-gr { color: #FF0000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
pre.pygments .tok-go { color: #888888 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #7D9029 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #0000FF } /* Name.Function */
pre.pygments .tok-nl { color: #A0A000 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>EMEWS Tutorial</h1>
<div class="details">
<span id="author" class="author">Version 1.0 Jan 12 2022</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_creating_emews_projects">1. Creating EMEWS Projects</a>
<ul class="sectlevel2">
<li><a href="#_installation">1.1. Installation</a></li>
<li><a href="#_using_emews_creator">1.2. Using EMEWS Creator</a></li>
<li><a href="#_emews_project_structure">1.3. EMEWS Project Structure</a>
<ul class="sectlevel3">
<li><a href="#_directories">1.3.1. Directories</a></li>
<li><a href="#_files">1.3.2. Files</a></li>
</ul>
</li>
<li><a href="#wflow_templates">1.4. Workflow Templates</a>
<ul class="sectlevel3">
<li><a href="#_sweep">1.4.1. Sweep</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#uc1">2. Simple Workflows with ABM</a>
<ul class="sectlevel2">
<li><a href="#_tutorial_goals">2.1. Tutorial goals:</a></li>
<li><a href="#_workflow_project_structure">2.2. Workflow Project Structure</a></li>
<li><a href="#_jzombie_repast_simulation">2.3. JZombie: Repast simulation</a>
<ul class="sectlevel3">
<li><a href="#_model_details">2.3.1. Model details</a></li>
</ul>
</li>
<li><a href="#_calling_a_repast_simphony_simulation_from_swiftt">2.4. Calling a Repast Simphony simulation from Swift/T</a>
<ul class="sectlevel3">
<li><a href="#_calling_the_external_application">2.4.1. Calling the External Application</a></li>
<li><a href="#_utility_functions">2.4.2. Utility Functions</a></li>
<li><a href="#_parameter_sweeping">2.4.3. Parameter Sweeping</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_creating_emews_projects">1. Creating EMEWS Projects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>EMEWS Creator is a Python application for creating workflow projects for EMEWS from
the command line. The project consists of the canonical EMEWS directory layout and
various files that can be customized by the user for their particular model.</p>
</div>
<div class="sect2">
<h3 id="_installation">1.1. Installation</h3>
<div class="paragraph">
<p>EMEWS Creator can be downloaded and installed from PyPI using pip.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>pip install emewscreator</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_emews_creator">1.2. Using EMEWS Creator</h3>
<div class="paragraph">
<p>Once installed EMEWS Creator is run from the command line. It has the following
options.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ emewscreator -h
Usage: emewscreator [OPTIONS] COMMAND [ARGS]...

Options:
  -V, --version          Show the version and exit.
  -o, --output-dir PATH  Directory into which the project template will be
                         generated. Defaults to the current directory

  -m, --model-name TEXT  Name of the model application. Defaults to "model".
  -w, --overwrite        Overwrite existing files
  -h, --help             Show this message and exit.

Commands:
  eqpy   create an eqpy workflow
  eqr    create an eqr workflow
  sweep  create a sweep workflow</pre>
</div>
</div>
<div class="paragraph">
<p>Each of the commands creates a particular type of workflow: a sweep, an eqpy-based workflow,
or an eqr-based workflow. Each of the commands has its own arguments specific to that
workflow type. These are specified on the command line after the COMMAND argument, and will
be covered in the <a href="#wflow_templates">Workflow Templates</a> section below.</p>
</div>
<div class="paragraph">
<p>The options supplied to <code>emewscreator</code> are common to all the workflow types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--output-dir</code> - the root directory of the directory structure and files created
by EMEWS Creator.</p>
</li>
<li>
<p><code>--model-name</code> - the name  of the model that will be run during the workflow.
This will be used in the model execution bash script. Spaces will be replaced by underscores.</p>
</li>
<li>
<p><code>--overwrite</code> - if present, EMEWS Creator will overwrite any existing files in the
<code>output-dir</code> directory when creating the workflow. By default, existing files will <strong>not</strong> be overwritten.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These values can also be supplied in a yaml format configuration file. Sample
configuration files can be found <a href="https://github.com/emews/emews-project-creator/tree/master/example_cfgs">here</a>
in the <code>example_cfgs</code> directory in the EMEWS Creator github repository.</p>
</div>
</div>
<div class="sect2">
<h3 id="_emews_project_structure">1.3. EMEWS Project Structure</h3>
<div class="paragraph">
<p>Each of the workflow types will create the default EMEWS project structure
in the directory specified by the <code>-o, --output-dir</code> argument.
EMEWS Creator is designed such that multiple workflows can be run in the same directory.
For example, you can begin with the <code>sweep</code> and then create an <code>eqr</code> or <code>eqpy</code>
workflow in the same output directory. When multiple workflows are created
in the same output directory, it is crucial that the <code>workflow_name</code>
configuration template argument is unique to each individual workflow. See
the <a href="#wflow_templates">Workflow Templates</a> section for more information on the <code>workflow_name</code>
argument.</p>
</div>
<div class="sect3">
<h4 id="_directories">1.3.1. Directories</h4>
<div class="paragraph">
<p>Given an <code>--output-dir</code> argument of <code>my_emews_project</code>, the default directory structure
produced by all the workflow types is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>my_emews_project/
├── data
├── etc
│   └── emews_utils.sh
├── ext
│   └── emews
│       └── emews.swift
├── python
│   └── test
├── R
│   └── test
├── README.md
├── scripts
│   └── run_my_model_sweep_workflow.sh
└── swift
    ├── cfgs
    │   └── sweep_workflow.cfg
    ├── run_sweep_workflow.sh
    └── sweep_workflow.swift</pre>
</div>
</div>
<div class="paragraph">
<p>The directories are intended to contain the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>data</code> - date required by the model and algorithm (inputs, etc.).</p>
</li>
<li>
<p><code>etc</code> - additional code used by EMEWS</p>
</li>
<li>
<p><code>ext</code> - Swift/T extensions, including the default EMEWS utility code extension as well as
the EQ/R and EQ/Py extensions when creating eqr or eqpy workflows</p>
</li>
<li>
<p><code>python</code> - Python code (e.g., model exploration algorithms written in Python)</p>
</li>
<li>
<p><code>python\test</code> - tests of the Python code</p>
</li>
<li>
<p><code>R</code> - R code (e.g., model exploration algorithms written R)</p>
</li>
<li>
<p><code>R\test</code> - tests of the R code</p>
</li>
<li>
<p><code>scripts</code> - any necessary scripts (e.g., scripts to launch a model), excluding scripts used to run the workflow</p>
</li>
<li>
<p><code>swift</code> - Swift/T code and scripts used to submit and run the workflow</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_files">1.3.2. Files</h4>
<div class="paragraph">
<p>Each of the workflow types will generate the following files. The file names
are derived from parameters specified in the workflow template configuration
arguments. The names of those parameters are included in curly brackets
in the file names below. (In the above directory listing, the workflow_name
was <code>sweep_workflow</code>.)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>swift/run_{workflow_name}.sh</code> - a bash script used to launch / submit the workflow</p>
</li>
<li>
<p><code>swift/{workflow_name}.swift</code> - the swift script that implements the workflow.</p>
</li>
<li>
<p><code>scripts/run_{model_name}_{workflow_name}.sh</code> - a bash script used to run the model application.</p>
</li>
<li>
<p><code>cfgs/{workflow_name}.cfg</code> - a configuration file for running the workflow</p>
</li>
<li>
<p><code>README.md</code> - a README file for the workflow</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These files may require some user customization before they can be used. The
relevant sections are marked with <code>TODO</code>.</p>
</div>
<div class="paragraph">
<p>Once any edits have been completed, the workflows can be run with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ run_{workflow_name}.sh &lt;experiment_name&gt; cfgs/{workflow_name}.cfg</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="wflow_templates">1.4. Workflow Templates</h3>
<div class="paragraph">
<p>Each workflow template has its own set of command line arguments, but all have the following
in common:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-n, --workflow-name</code> - the name of the workflow. This will be used as the file name for the workflow configuration, submission, and swift script files. Spaces will be replaced by underscores.
<strong>The <code>workflow_name</code> should be unique among all the workflows in the output directory.</strong></p>
</li>
<li>
<p><code>-c, --config</code> - path to the workflow template configuration file, optional if all
the required arguments are specified on the command line</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The workflow template configuration file can be used to specify any of a
workflow template&#8217;s configuration parameters when those parameters are
not specified on the command line. This file is in yaml format.
Sample configuration files can be found
<a href="https://github.com/emews/emews-project-creator/tree/master/example_cfgs">here</a>.
in the <code>example_cfgs</code> directory in the EMEWS Creator github repository. Arguments
supplied on the command line will override those supplied in a configuration file.
If any required arguments are missing from the command line, then the
configuration file is required to supply the missing arguments.</p>
</div>
<div class="sect3">
<h4 id="_sweep">1.4.1. Sweep</h4>
<div class="paragraph">
<p>The sweep command creates a sweep workflow in which EMEWS reads an input file,
and runs an application using each line of the input file as input to an application run.
We call this input file an <em>unrolled parameter file</em> or <em>UPF</em> file, as it contains a
full explicit listing of all the parameter combinations to run, rather than some
more terse sweep description.</p>
</div>
<div class="paragraph">
<p>Usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ emewscreator sweep -h
Usage: emewscreator sweep [OPTIONS]

Options:
  -c, --config PATH         Path to the template configuration file
                            [required if any command line arguments are
                            missing]

  -n, --workflow-name TEXT  Name of the workflow
  -h, --help                Show this message and exit.</pre>
</div>
</div>
<div class="paragraph">
<p>A sample sweep configuration file can be found <a href="https://github.com/emews/emews-project-creator/blob/master/example_cfgs/sweep.yaml" target="sweep.yaml">here</a>.</p>
</div>
<div class="paragraph">
<p>Generating a sweep workflow creates the following files. The exact file names are dependent on
the workflow_name and model_name configuration parameters. Here the workflow name is <code>sweep workflow</code>
and the model name is <code>my model</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>swift/run_sweep_workflow.sh</code> - a bash script used to launch the workflow</p>
</li>
<li>
<p><code>swift/sweep_workflow.swift</code> - a swift script that will iterate through an input file, passing each line of that input to a model</p>
</li>
<li>
<p><code>scripts/run_my_model_sweep_workflow.sh</code> - a bash script for executing the model. The swift script calls this script
to run the model, passing it one line of input from the input file.</p>
</li>
<li>
<p><code>swift/cfgs/sweep_workflow.cfg</code> - the configuration file for the workflow, specifying the location of the sweep input file,
among other parameters.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These files contain lines or sections marked with <strong>TODO</strong> where that line or section needs
to be edited to customize the file for your model and workflow. See <a href="#uc1">Use Case 1 Tutorial - Simple Workflows with ABM</a> for a fully fleshed out
sweep workflow created using emews creator. We will look more closely at relevant parts of these files
below.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/2843e5d305c93e38f56988c75e1a723e73b30d8d/code/emews_project/swift/run_sweep_workflow.sh#L1" target="UC1"><code><strong>run_sweep_workflow.sh</strong></code></a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The launch scripts produced by the emews creator <em>source</em> other files. Doing this in a bash script
makes any variables and functions defined in those files available to the current file. as if they had been
defined in the current file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The initial section of the file processes the input arguments to the file,
initalizing some variables that used in the following parts of the file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-ch">#! /usr/bin/env bash</span>
<span class="tok-nb">set</span> -eu

<span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-s2">&quot;</span><span class="tok-nv">$#</span><span class="tok-s2">&quot;</span> -ne <span class="tok-m">2</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>    <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-nv">script_name</span><span class="tok-o">=</span><span class="tok-k">$(</span>basename <span class="tok-nv">$0</span><span class="tok-k">)</span>
  <span class="tok-nb">echo</span> <span class="tok-s2">&quot;Usage: </span><span class="tok-si">${</span><span class="tok-nv">script_name</span><span class="tok-si">}</span><span class="tok-s2"> exp_id cfg_file&quot;</span>
  <span class="tok-nb">exit</span> <span class="tok-m">1</span>
<span class="tok-k">fi</span>

<span class="tok-c1"># Uncomment to turn on swift/t logging. Can also set TURBINE_LOG,</span>
<span class="tok-c1"># TURBINE_DEBUG, and ADLB_DEBUG to 0 to turn off logging</span>
<span class="tok-c1"># export TURBINE_LOG=1 TURBINE_DEBUG=1 ADLB_DEBUG=1</span>
<span class="tok-nb">export</span> <span class="tok-nv">EMEWS_PROJECT_ROOT</span><span class="tok-o">=</span><span class="tok-k">$(</span> <span class="tok-nb">cd</span> <span class="tok-k">$(</span> dirname <span class="tok-nv">$0</span> <span class="tok-k">)</span>/.. <span class="tok-p">;</span> /bin/pwd <span class="tok-k">)</span>    <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-c1"># source some utility functions used by EMEWS in this script</span>
<span class="tok-nb">source</span> <span class="tok-s2">&quot;</span><span class="tok-si">${</span><span class="tok-nv">EMEWS_PROJECT_ROOT</span><span class="tok-si">}</span><span class="tok-s2">/etc/emews_utils.sh&quot;</span>    <i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-nb">export</span> <span class="tok-nv">EXPID</span><span class="tok-o">=</span><span class="tok-nv">$1</span>
<span class="tok-nb">export</span> <span class="tok-nv">TURBINE_OUTPUT</span><span class="tok-o">=</span><span class="tok-nv">$EMEWS_PROJECT_ROOT</span>/experiments/<span class="tok-nv">$EXPID</span>    <i class="conum" data-value="4"></i><b>(4)</b>
check_directory_exists

<span class="tok-nv">CFG_FILE</span><span class="tok-o">=</span><span class="tok-nv">$2</span>
<span class="tok-nb">source</span> <span class="tok-nv">$CFG_FILE</span>     <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Check that the number of arguments passed to the script is equal to 2. The first should
be the name of the experiment, and the second a configuration file that will be sourced
into the current environment.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define an <code>EMEWS_PROJECT_ROOT`</code> environment variable that specifies the root directory of the project.
This corresponds to the root project directory specified in <code>--output-dir</code> when running
emewscreator.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Source some utiliity functions that are used later in the script. These are: <code>check_directory_exists</code> which checks if the <code>TURBINE_OUTPUT</code> directory exists and prompts the user to continue; and <code>log_script</code> which logs the relevant environment variables and a copy of script to the <code>TURBINE_OUTPUT</code> directory.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creates and exports an <code>EXPID</code> (an experiment id) environment variable from the experiment id passed into the script and then defines the <code>TURBINE_OUTPUT</code> directory using this <code>EXPID</code>. The <code>TURBINE_OUTPUT</code> directory is used by swift as the
output location for all the files that it produces.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Creates a CFG_FILE environment variable from the second argument passed into the script, and sources this file.
In this way the configuration variables, such as the file to sweep over, are made available to the launch script.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The second part of the file exports some variables that are used by swift
when submitting the workflow on an HPC resource. Typically such machines use
a job scheduler that requires the user to provide the number of processes
to use, the name of the compute queue, the project to charge the compute time
to, and an estimate of how long the job will take. This section exports
those values so that they are available to swift when creating the job submission
script. These are set from values defined in the workflow configuration file
(i.e., swift/cfgs/sweep_workflow.cfg). See the discussion of that file below.
<mark>TODO: make link</mark></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nb">export</span> <span class="tok-nv">PROCS</span><span class="tok-o">=</span><span class="tok-nv">$CFG_PROCS</span>    <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nb">export</span> <span class="tok-nv">QUEUE</span><span class="tok-o">=</span><span class="tok-nv">$CFG_QUEUE</span>
<span class="tok-nb">export</span> <span class="tok-nv">PROJECT</span><span class="tok-o">=</span><span class="tok-nv">$CFG_PROJECT</span>
<span class="tok-nb">export</span> <span class="tok-nv">WALLTIME</span><span class="tok-o">=</span><span class="tok-nv">$CFG_WALLTIME</span>
<span class="tok-nb">export</span> <span class="tok-nv">PPN</span><span class="tok-o">=</span><span class="tok-nv">$CFG_PPN</span>
<span class="tok-nb">export</span> <span class="tok-nv">TURBINE_JOBNAME</span><span class="tok-o">=</span><span class="tok-s2">&quot;</span><span class="tok-si">${</span><span class="tok-nv">EXPID</span><span class="tok-si">}</span><span class="tok-s2">_job&quot;</span>    <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nb">export</span> <span class="tok-nv">TURBINE_MPI_THREAD</span><span class="tok-o">=</span><span class="tok-m">1</span>    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>PROCS</code>, <code>QUEUE</code>, <code>PROJECT</code>, <code>WALLTIME</code>, and <code>PPN</code> are set from variables defined
in the configuration file. See that section for more info <mark>TODO</mark></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>TURBINE_JOBNAME</code> is used to set the name of the job in the HPC submission script.
When querying the HPC resource for the status of your job, you will see your job
name as the experiment id following by <code>_job</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set <code>TURBINE_MPI_THREAD</code> to one to run MPI in a thread-safe mode to prevent any errors
if the model is multi-threaded.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The launch scripts for all the available workflow types copy all the relevant
files into the experiment directory (i.e., <code>TURBINE_OUTPUT</code>) so that the original
files can be changed without corrupting the workflow. We see that in the next
section together with some variable declarations and some potential TODOs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>mkdir -p <span class="tok-nv">$TURBINE_OUTPUT</span>    <i class="conum" data-value="1"></i><b>(1)</b>
cp <span class="tok-nv">$CFG_FILE</span> <span class="tok-nv">$TURBINE_OUTPUT</span>/cfg.cfg    <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-c1"># TODO: If R cannot be found, then these will need to be   </span><i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-c1"># uncommented and set correctly.</span>
<span class="tok-c1"># export R_HOME=/path/to/R</span>
<span class="tok-c1"># export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$R_HOME/lib</span>

<span class="tok-c1"># TODO: If Python cannot be found or there are &quot;Cannot find     </span><i class="conum" data-value="4"></i><b>(4)</b>
<span class="tok-c1"># X package&quot; type errors then these two environment variables</span>
<span class="tok-c1"># will need to be uncommented and set correctly.</span>
<span class="tok-c1"># export PYTHONHOME=/path/to/python</span>
<span class="tok-c1"># export PYTHONPATH=$EMEWS_PROJECT_ROOT/python</span>

<span class="tok-nv">EMEWS_EXT</span><span class="tok-o">=</span><span class="tok-nv">$EMEWS_PROJECT_ROOT</span>/ext/emews    <i class="conum" data-value="5"></i><b>(5)</b>

<span class="tok-c1"># Copies UPF file to experiment directory</span>
<span class="tok-nv">U_UPF_FILE</span><span class="tok-o">=</span><span class="tok-nv">$EMEWS_PROJECT_ROOT</span>/<span class="tok-nv">$CFG_UPF</span>
<span class="tok-nv">UPF_FILE</span><span class="tok-o">=</span><span class="tok-nv">$TURBINE_OUTPUT</span>/upf.txt
cp <span class="tok-nv">$U_UPF_FILE</span> <span class="tok-nv">$UPF_FILE</span>    <i class="conum" data-value="6"></i><b>(6)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make the <code>TURBINE_OUTPUT</code> experiment directory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Copy the workflow configuration file into the experiment directory</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If there are errors when running R code in workflows, this section
can be edited appropriately and uncommented.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If there are errors when running Python code in workflows, this section
can be edited appropriately and uncommented.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Set an environment directory for the EMEWS swift extensions. This is
used internally by the workflow, and should not be edited.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Copy the <em>UPF</em> file to experiment directory as <code>upf.txt</code>. This
is the file containing the sweep input, one parameter set per line.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The launch script pass arguments to the swift script via the command line.
We define a variable that represents the command line and pass the
location of the <em>UPF</em> file using that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">CMD_LINE_ARGS</span><span class="tok-o">=</span><span class="tok-s2">&quot;</span><span class="tok-nv">$*</span><span class="tok-s2"> -f=</span><span class="tok-nv">$UPF_FILE</span><span class="tok-s2"> &quot;</span>
<span class="tok-c1"># CMD_LINE_ARGS can be extended with +=:</span>
<span class="tok-c1"># CMD_LINE_ARGS+=&quot;-another_arg=$ANOTHER_VAR&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When submitting the workflow on an HPC machine, the type of job scheduled must be set in order for
swift to correctly submit the job. This is done in the next section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># TODO: Set MACHINE to your schedule type (e.g. pbs, slurm, cobalt etc.),</span>
<span class="tok-c1"># or empty for an immediate non-queued unscheduled run</span>
<span class="tok-nv">MACHINE</span><span class="tok-o">=</span><span class="tok-s2">&quot;&quot;</span>

<span class="tok-k">if</span> <span class="tok-o">[</span> -n <span class="tok-s2">&quot;</span><span class="tok-nv">$MACHINE</span><span class="tok-s2">&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
  <span class="tok-nv">MACHINE</span><span class="tok-o">=</span><span class="tok-s2">&quot;-m </span><span class="tok-nv">$MACHINE</span><span class="tok-s2">&quot;</span>
<span class="tok-k">fi</span>

<span class="tok-c1"># TODO: Some slurm machines may expect jobs to be run</span>
<span class="tok-c1"># with srun, rather than the default mpiexec (for example). If</span>
<span class="tok-c1"># so, uncomment this export.</span>
<span class="tok-c1"># export TURBINE_LAUNCHER=srun</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The final section logs a copy of the submission script to the experiment directory and
calls swift-t to submit the job and execute the workflow swift script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># TODO: Add any script variables that you want to log as</span>
<span class="tok-c1"># part of the experiment meta data to the USER_VARS array,</span>
<span class="tok-c1"># for example, USER_VARS=(&quot;VAR_1&quot; &quot;VAR_2&quot;)</span>
<span class="tok-nv">USER_VARS</span><span class="tok-o">=()</span>
<span class="tok-c1"># log variables and script to to TURBINE_OUTPUT directory</span>
log_script    <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-c1"># echo&#39;s anything following this to standard out</span>
<span class="tok-nb">set</span> -x
<span class="tok-nv">SWIFT_FILE</span><span class="tok-o">=</span>sweep_workflow.swift    <i class="conum" data-value="2"></i><b>(2)</b>
swift-t -n <span class="tok-nv">$PROCS</span> <span class="tok-nv">$MACHINE</span> -p <span class="tok-se">\ </span>   <i class="conum" data-value="3"></i><b>(3)</b>
    -I <span class="tok-nv">$EMEWS_EXT</span> -r <span class="tok-nv">$EMEWS_EXT</span> <span class="tok-se">\</span>
    -e TURBINE_MPI_THREAD <span class="tok-se">\ </span>   <i class="conum" data-value="4"></i><b>(4)</b>
    -e TURBINE_OUTPUT <span class="tok-se">\</span>
    -e EMEWS_PROJECT_ROOT <span class="tok-se">\</span>
    <span class="tok-nv">$EMEWS_PROJECT_ROOT</span>/swift/<span class="tok-nv">$SWIFT_FILE</span> <span class="tok-se">\</span>
    <span class="tok-nv">$CMD_LINE_ARGS</span>    <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Log a copy of this submission script including any of the variables
in <code>USER_VARS</code> to the experiment directory.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define a variable containing the name of the swift workflow script to
execute.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Call swift-t passing it the relevant variables and the path of the swift script to be executed. At this point the script is either executed immediately or scheduled for execution depending on the value of the MACHINE variable.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>-e</code> agument to swift-t adds the specified variable to the script execution environment. On some HPC machines,
the login environment is separate from the compute environment. Consequently, variables defined in the login environment
that are referenced in the swift script when it executes in the compute environment need to be made available for the
script to work correctly. The <code>-e</code> argument does this, adding the specified variables to the compute environment.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Pass the <code>CMD_LINE_ARGS</code> to the swift script.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/2843e5d305c93e38f56988c75e1a723e73b30d8d/code/emews_project/swift/sweep_workflow.swift#L1" target="UC1"><code><strong>sweep_workflow.swift</strong></code></a></p>
</div>
<div class="paragraph">
<p>This file is the swift script that performs the actual sweep. The script consists of an opening section that
defines some variables, and 3 functions, one (<code>run_model</code>) that calls the model itself, one (<code>make_dir</code>) utility
function, and a <code>main</code> function that performs the sweep.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="swift"><span></span><span class="tok-n">string</span> <span class="tok-n">emews_root</span> <span class="tok-p">=</span> <span class="tok-n">getenv</span><span class="tok-p">(</span><span class="tok-s">&quot;EMEWS_PROJECT_ROOT&quot;</span><span class="tok-p">);</span>    <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">string</span> <span class="tok-n">turbine_output</span> <span class="tok-p">=</span> <span class="tok-n">getenv</span><span class="tok-p">(</span><span class="tok-s">&quot;TURBINE_OUTPUT&quot;</span><span class="tok-p">);</span>

<span class="tok-n">file</span> <span class="tok-n">model_sh</span> <span class="tok-p">=</span> <span class="tok-n">input</span><span class="tok-p">(</span><span class="tok-n">emews_root</span><span class="tok-o">+</span><span class="tok-s">&quot;/scripts/run_my_model_sweep_workflow.sh&quot;</span><span class="tok-p">);</span>    <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">file</span> <span class="tok-n">upf</span> <span class="tok-p">=</span> <span class="tok-n">input</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">(</span><span class="tok-s">&quot;f&quot;</span><span class="tok-p">));</span>    <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set <code>emews_root</code> and <code>turbine_output</code> from the <code>EMEWS_PROJECT_ROOT</code> and <code>TURBINE_OUTPUT</code>
environment variables. These were exported in the
<a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/2843e5d305c93e38f56988c75e1a723e73b30d8d/code/emews_project/swift/run_sweep_workflow.sh#L1" target="UC1"><code>run_sweep_workflow.sh</code></a> script.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Get the bash script that will be used to launch the model. Swift calls this script
(<code>scripts/run_my_model_sweep_workflow.sh</code>) to perform a model run.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Get the upf file by parsing the <code>-f</code> argument to this script. The <code>-f</code> argument was specified in
as part of the <code>CMD_LINE_ARGS</code> in the <a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/2843e5d305c93e38f56988c75e1a723e73b30d8d/code/emews_project/swift/run_sweep_workflow.sh#L1" target="UC1"><code>run_sweep_workflow.sh</code></a> script.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>run_model</code> function function executes a single model run via a bash script. It calls bash, passing it the name of the bash
script to run, the parameter line (from the upf file) to use, the EMEWS_PROJECT_ROOT directory, and the path of an instance directory. The expectation is that each model run will execute in its own directory and instance is the path of that directory. Standard out and standard error are redirected to an out and err file respectively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="swift"><span></span><span class="tok-c1">// app function used to run the model</span>
<span class="tok-n">app</span> <span class="tok-p">(</span><span class="tok-n">file</span> <span class="tok-n">out</span><span class="tok-p">,</span> <span class="tok-n">file</span> <span class="tok-n">err</span><span class="tok-p">)</span> <span class="tok-n">run_model</span><span class="tok-p">(</span><span class="tok-n">file</span> <span class="tok-n">shfile</span><span class="tok-p">,</span> <span class="tok-n">string</span> <span class="tok-n">param_line</span><span class="tok-p">,</span> <span class="tok-n">string</span> <span class="tok-n">instance</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-s">&quot;bash&quot;</span> <span class="tok-n">shfile</span> <span class="tok-n">param_line</span> <span class="tok-n">emews_root</span> <span class="tok-n">instance</span> <span class="tok-p">@</span><span class="tok-n">stdout</span><span class="tok-p">=</span><span class="tok-n">out</span> <span class="tok-p">@</span><span class="tok-n">stderr</span><span class="tok-p">=</span><span class="tok-n">err</span><span class="tok-p">;</span>    <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Call <code>bash</code> to run the model script specified in the previous section, redirecting
<code>stdout</code> and <code>stderr</code> to <code>file out</code> and <code>file in</code> respectively.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we run the model, we want each to run in its own <em>instance</em> directory, and we
need a function to create that directory. <code>make_dir</code> is a Swift app function
that calls the operating system&#8217;s <code>mkdir</code> command to create the directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="swift"><span></span><span class="tok-c1">// call this to create any required directories</span>
<span class="tok-n">app</span> <span class="tok-p">(</span><span class="tok-n">void</span> <span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-n">make_dir</span><span class="tok-p">(</span><span class="tok-n">string</span> <span class="tok-n">dirname</span><span class="tok-p">)</span> <span class="tok-p">{</span>
    <span class="tok-s">&quot;mkdir&quot;</span> <span class="tok-s">&quot;-p&quot;</span> <span class="tok-n">dirname</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>main</code> function iterates over each line of the upf file, passing each line
to the model script to run.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="swift"><span></span><span class="tok-c1">// Iterate over each line in the upf file, passing each line</span>
<span class="tok-c1">// to the model script to run</span>
<span class="tok-n">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
    <span class="tok-c1">// run_prerequisites() =&gt; {</span>
    <span class="tok-n">string</span> <span class="tok-n">upf_lines</span><span class="tok-p">[]</span> <span class="tok-p">=</span> <span class="tok-n">file_lines</span><span class="tok-p">(</span><span class="tok-n">upf</span><span class="tok-p">);</span>    <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tok-n">foreach</span> <span class="tok-n">s</span><span class="tok-p">,</span><span class="tok-n">i</span> <span class="tok-k">in</span> <span class="tok-n">upf_lines</span> <span class="tok-p">{</span>    <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="tok-n">string</span> <span class="tok-n">instance</span> <span class="tok-p">=</span> <span class="tok-s">&quot;%s/instance_%i/&quot;</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">turbine_output</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">);</span>   <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="tok-n">make_dir</span><span class="tok-p">(</span><span class="tok-n">instance</span><span class="tok-p">)</span> <span class="tok-p">=</span><span class="tok-o">&gt;</span> <span class="tok-p">{</span>    <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="tok-n">file</span> <span class="tok-n">out</span> <span class="tok-p">&lt;</span><span class="tok-n">instance</span><span class="tok-o">+</span><span class="tok-s">&quot;out.txt&quot;</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>    <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="tok-n">file</span> <span class="tok-n">err</span> <span class="tok-p">&lt;</span><span class="tok-n">instance</span><span class="tok-o">+</span><span class="tok-s">&quot;err.txt&quot;</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>
            <span class="tok-p">(</span><span class="tok-n">out</span><span class="tok-p">,</span><span class="tok-n">err</span><span class="tok-p">)</span> <span class="tok-p">=</span> <span class="tok-n">run_model</span><span class="tok-p">(</span><span class="tok-n">model_sh</span><span class="tok-p">,</span> <span class="tok-n">s</span><span class="tok-p">,</span> <span class="tok-n">instance</span><span class="tok-p">);</span>    <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="tok-p">}</span>
    <span class="tok-p">}</span>
    <span class="tok-c1">// }</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Read all the lines from the upf file into a string array <code>upf_lines</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>For each line in the array, executing the code within the block. This
will run in parallel, executing as many lines concurrently as there are
available workers. Here <code>s</code> is the element at index <code>i</code> in the <code>upf_lines</code> array,
such that <code>i</code> corresponds to the line number in the upf file itself.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create the name of the instance directory that we pass to each model execution,
using <code>i</code> to uniquely name each instance directory.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Call <code>make_dir</code> to create each instance directory.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Create the files into which the <code>stdout</code> and <code>stderr</code> will
be written for each model run in each instance directory, naming
them <code>out.txt</code> and <code>err.txt</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Call <code>run_model</code> to execute the model run.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/2843e5d305c93e38f56988c75e1a723e73b30d8d/code/emews_project/scripts/run_my_model_sweep_workflow.sh#L1" target="UC1"><code><strong>run_my_model_sweep_workflow.sh</strong></code></a></p>
</div>
<div class="paragraph">
<p><code>run_my_model_sweep_workflow.sh</code> is called by <code>sweep_workflow.swift</code> to execute
the model as if the model has been run from the command line. The script passed
single line of parameters from the upf file, the
emews root directory location, and the instance directory created in <code>sweep_workflow.swift</code>.
You will need to update the <code>MODEL_CMD</code> variable to specify the model executable.</p>
</div>
<div class="paragraph">
<p>The script begins with defining an optional <code>TIMEOUT</code> that will timeout
the model if its run duration exceeds that value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># Check for an optional timeout threshold in seconds. If the duration of the</span>
<span class="tok-c1"># model run as executed below, takes longer that this threshhold</span>
<span class="tok-c1"># then the run will be aborted. Note that the &quot;timeout&quot; command</span>
<span class="tok-c1"># must be supported by executing OS.</span>

<span class="tok-c1"># The timeout argument is optional. By default the &quot;run_model&quot; swift</span>
<span class="tok-c1"># app fuction sends 3 arguments, and no timeout value is set. If there</span>
<span class="tok-c1"># is a 4th (the TIMEOUT_ARG_INDEX) argument, we use that as the timeout value.</span>

<span class="tok-c1"># !!! IF YOU CHANGE THE NUMBER OF ARGUMENTS PASSED TO THIS SCRIPT, YOU MUST</span>
<span class="tok-c1"># CHANGE THE TIMEOUT_ARG_INDEX !!!</span>
<span class="tok-nv">TIMEOUT</span><span class="tok-o">=</span><span class="tok-s2">&quot;&quot;</span>
<span class="tok-nv">TIMEOUT_ARG_INDEX</span><span class="tok-o">=</span><span class="tok-m">4</span>    <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-k">if</span> <span class="tok-o">[[</span> <span class="tok-nv">$#</span> <span class="tok-o">==</span>  <span class="tok-nv">$TIMEOUT_ARG_INDEX</span> <span class="tok-o">]]</span>
<span class="tok-k">then</span>
	<span class="tok-nv">TIMEOUT</span><span class="tok-o">=</span><span class="tok-si">${</span><span class="tok-p">!TIMEOUT_ARG_INDEX</span><span class="tok-si">}</span>
<span class="tok-k">fi</span>

<span class="tok-nv">TIMEOUT_CMD</span><span class="tok-o">=</span><span class="tok-s2">&quot;&quot;</span>
<span class="tok-k">if</span> <span class="tok-o">[</span> -n <span class="tok-s2">&quot;</span><span class="tok-nv">$TIMEOUT</span><span class="tok-s2">&quot;</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
  <span class="tok-nv">TIMEOUT_CMD</span><span class="tok-o">=</span><span class="tok-s2">&quot;timeout </span><span class="tok-nv">$TIMEOUT</span><span class="tok-s2">&quot;</span>
<span class="tok-k">fi</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If this script is passed <code>TIMEOUT_ARG_INDEX</code> number of arguments,
then that argument (defaulting to the 4th argument) will be used as
the number of seconds after which to timeout.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next section of the script assigns the scripts command line arguments to
some variables and changes directory to the instance directory passed to
the script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># Set PARAM_LINE from the first argument to this script</span>
<span class="tok-c1"># PARAM_LINE is the string containing the model parameters for a run.</span>
<span class="tok-nv">PARAM_LINE</span><span class="tok-o">=</span><span class="tok-nv">$1</span>

<span class="tok-c1"># Set EMEWS_ROOT to the root directory of the project (i.e. the directory</span>
<span class="tok-c1"># that contains the scripts, swift, etc. directories and files)</span>
<span class="tok-nv">EMEWS_ROOT</span><span class="tok-o">=</span><span class="tok-nv">$2</span>

<span class="tok-c1"># Each model run, runs in its own &quot;instance&quot; directory</span>
<span class="tok-c1"># Set INSTANCE_DIRECTORY to that and cd into it.</span>
<span class="tok-nv">INSTANCE_DIRECTORY</span><span class="tok-o">=</span><span class="tok-nv">$3</span>
<span class="tok-nb">cd</span> <span class="tok-nv">$INSTANCE_DIRECTORY</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The final section defines the model executable in <code>MODEL_CMD</code> and runs
the model with the optional timeout.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-c1"># TODO: Define the command to run the model. For example,</span>
<span class="tok-c1"># MODEL_CMD=&quot;python&quot;</span>
<span class="tok-nv">MODEL_CMD</span><span class="tok-o">=</span><span class="tok-s2">&quot;&quot;</span>    <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-c1"># TODO: Define the arguments to the MODEL_CMD. Each argument should be</span>
<span class="tok-c1"># surrounded by quotes and separated by spaces. For example,</span>
<span class="tok-c1"># arg_array=(&quot;$EMEWS_ROOT/python/my_model.py&quot; &quot;$PARAM_LINE&quot;)</span>
<span class="tok-nv">arg_array</span><span class="tok-o">=(</span><span class="tok-s2">&quot;arg1&quot;</span> <span class="tok-s2">&quot;arg2&quot;</span> <span class="tok-s2">&quot;arg3&quot;</span><span class="tok-o">)</span>    <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nv">COMMAND</span><span class="tok-o">=</span><span class="tok-s2">&quot;</span><span class="tok-nv">$MODEL_CMD</span><span class="tok-s2"> </span><span class="tok-si">${</span><span class="tok-nv">arg_array</span><span class="tok-p">[@]</span><span class="tok-si">}</span><span class="tok-s2">&quot;</span>

<span class="tok-c1"># Turn bash error checking off. This is</span>
<span class="tok-c1"># required to properly handle the model execution</span>
<span class="tok-c1"># return values and the optional timeout.</span>
<span class="tok-nb">set</span> +e
<span class="tok-nb">echo</span> <span class="tok-s2">&quot;Running </span><span class="tok-nv">$COMMAND</span><span class="tok-s2">&quot;</span>

<span class="tok-nv">$TIMEOUT_CMD</span> <span class="tok-nv">$COMMAND</span>    <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-c1"># $? is the exit status of the most recently executed command (i.e the</span>
<span class="tok-c1"># line above)</span>
<span class="tok-nv">RES</span><span class="tok-o">=</span><span class="tok-nv">$?</span>
<span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-s2">&quot;</span><span class="tok-nv">$RES</span><span class="tok-s2">&quot;</span> -ne <span class="tok-m">0</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
	<span class="tok-k">if</span> <span class="tok-o">[</span> <span class="tok-s2">&quot;</span><span class="tok-nv">$RES</span><span class="tok-s2">&quot;</span> <span class="tok-o">==</span> <span class="tok-m">124</span> <span class="tok-o">]</span><span class="tok-p">;</span> <span class="tok-k">then</span>
    <span class="tok-nb">echo</span> <span class="tok-s2">&quot;---&gt; Timeout error in </span><span class="tok-nv">$COMMAND</span><span class="tok-s2">&quot;</span>
  <span class="tok-k">else</span>
	   <span class="tok-nb">echo</span> <span class="tok-s2">&quot;---&gt; Error in </span><span class="tok-nv">$COMMAND</span><span class="tok-s2">&quot;</span>
  <span class="tok-k">fi</span>
<span class="tok-k">fi</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define the model executable. For a stand alone compiled executable, this will be
path to that executable. For example, something like <code>$HOME/sfw/epi_model-1.0/bin/epimodel</code>.
For a model written in an interpreted language such as R or Python, this will be the R/RScript or Python
executable.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the array of arguments to pass to the <code>MODEL_CMD</code> executable. At the very
least, this will typically include the <code>PARAM_LINE</code> variable in order to pass the
upf line to the model. For an R or Python application, this will also include
the path to the R or Python code to run.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Run the model with the optional <code>TIMEOUT_CMD</code>. If no <code>TIMEOUT</code> was specified, this
will be empty.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/2843e5d305c93e38f56988c75e1a723e73b30d8d/code/emews_project/swift/cfgs/sweep_workflow.cfg#L1" target="UC1"><code><strong>sweep_workflow.cfg</strong></code></a></p>
</div>
<div class="paragraph">
<p>The final file produced by the emewscreator for the sweep workflow is
<a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/2843e5d305c93e38f56988c75e1a723e73b30d8d/code/emews_project/swift/cfgs/sweep_workflow.cfg#L1" target="UC1"><code>sweep_workflow.cfg</code></a>.
This file is sourced by the submission script <a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/2843e5d305c93e38f56988c75e1a723e73b30d8d/code/emews_project/swift/run_sweep_workflow.sh#L1" target="UC1"><code>run_sweep_workflow.sh</code></a> to retrieve the HPC scheduler parameters for the workflow and the location
of the upf file. The intention here is that these parameters are the most frequently changed between
different workflow runs, and rather than edit the submission script itself, it is easier to edit
a configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span><span class="tok-nv">CFG_WALLTIME</span><span class="tok-o">=</span><span class="tok-m">24</span>:00:00   <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nv">CFG_QUEUE</span><span class="tok-o">=</span>queue    <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nv">CFG_PROJECT</span><span class="tok-o">=</span>project    <i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-nv">NODES</span><span class="tok-o">=</span><span class="tok-m">4</span>    <i class="conum" data-value="4"></i><b>(4)</b>
<span class="tok-nv">CFG_PPN</span><span class="tok-o">=</span><span class="tok-m">4</span>    <i class="conum" data-value="5"></i><b>(5)</b>
<span class="tok-nv">CFG_PROCS</span><span class="tok-o">=</span><span class="tok-k">$((</span> NODES <span class="tok-o">*</span> CFG_PPN <span class="tok-k">))</span>    <i class="conum" data-value="6"></i><b>(6)</b>
<span class="tok-c1"># TODO: Update with path to upf file, relative</span>
<span class="tok-c1"># to emews project root directory.</span>
<span class="tok-nv">CFG_UPF</span><span class="tok-o">=</span>data/upf.txt    <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the estimated duration of the workflow.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the queue on which to run the workflow.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the project with which to run the workflow.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Set the number of HPC nodes to run the workflow with.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Set the number of process per node (PPN) to use.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Compute the total number of processes to allocate to the job
by multiplying the number of nodes by the PPN.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Set the path to the UPF file. For convenience, this is relative to the
emews project root directory.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See your HPC resource&#8217;s documentation for details on the appropriate values and formats
for <code>CFG_WALLTIME</code>, <code>CFG_QUEUE</code>, and <code>CFG_PROJECT</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<mark>Highlights</mark> below have in source TODOs.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="uc1">2. Simple Workflows with ABM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a first demonstration ABM use case, we begin with an example of a Swift/T
parallel parameter sweep to explore the parameter space of a model.
This tutorial uses the project structure and files created from the
EMEWS <mark><a href="#_sweep_template">sweep template</a></mark>,
and that should be read before this.</p>
</div>
<div class="sect2">
<h3 id="_tutorial_goals">2.1. Tutorial goals:</h3>
<div class="ulist">
<ul>
<li>
<p>Run an ABM simulation using Repast in Swift/T</p>
</li>
<li>
<p>Execute parallel parameters sweep of ABM simulation model</p>
</li>
<li>
<p>Implement parallel evaluation of the simulation results using Swift/T and R</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_workflow_project_structure">2.2. Workflow Project Structure</h3>
<div class="paragraph">
<p>The full source code for this tutorial use case can be accessed <a href="https://github.com/jozik/emews_next_gen_tutorial_tests/tree/main/code/uc1" target="UC1">here</a>.
The completed workflow project has the following directory <mark>structure and files</mark>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="text"><span></span>uc1
├── R
│   └── test
├── README.md
├── data
├── etc
│   └── emews_utils.sh
├── ext
│   └── emews
│       └── emews.swift
├── python
│   └── test
├── scripts
│   └── run_repast_uc1.sh
└── swift
    ├── cfgs
    │   └── sweep_workflow.cfg
    ├── run_sweep_workflow.sh
    └── sweep_workflow.swift</code></pre>
</div>
</div>
<div class="paragraph">
<p>An initial version of the project was created using the EMEWS creator with the following command issued <mark>TODO, where?</mark>:</p>
</div>
<div id="uc1-creator" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>emewscreator -o uc1 sweep -c tutorial_cfgs/sweep.yaml</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For running this use case, an R enabled Swift/T installation is required.
See the <a href="http://swift-lang.github.io/swift-t/guide.html#build_r" target="_blank" rel="noopener">Swift/T R Installation Guide</a> for installation details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jzombie_repast_simulation">2.3. JZombie: Repast simulation</h3>
<div class="paragraph">
<p>The example model used here is an adaptation of the JZombies demonstration model distributed with Repast Simphony
(<a href="https://repast.github.io/docs/RepastJavaGettingStarted.pdf" target="_blank" rel="noopener">Nick Collier and Michael North 2015</a>). This is only an example model. Any simulation
or scientific application that can be
launched from the command line can be adapted to this paradigm. The fictional Zombies
versus Humans model is intended to illustrate that EMEWS, Swift/T, and Repast Simphony are domain agnostic.</p>
</div>
<div class="sect3">
<h4 id="_model_details">2.3.1. Model details</h4>
<div class="paragraph">
<p>The model has two kinds of agents, Zombies and Humans. Zombies chase the Humans,
seeking to infect them, while Humans attempt to evade Zombies. When a
Zombie is close enough to a Human, that Human is infected and becomes a
Zombie. During a typical run all the Humans will eventually become Zombies.
These agents are located in a two dimensional continuous
space where each agent has a x and y coordinate expressed as a floating point number
(and in a corresponding discrete grid with integer coordinates).
Movement is performed in the continuous space and translated into discrete grid coordinates.
The grid is used for neighborhood queries (e.g., given a Zombie’s location, where are the nearest Humans).
The model records the grid coordinate of each agent as well as a count of each agent type (Zombie or Human)
at each time step and writes this data to two files.
The initial number of Zombies and Humans is specified
by model input parameters zombie count and human count, and the distance a Zombie or Human can move at each
time step is specified by the parameters zombie step size and human step size.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_calling_a_repast_simphony_simulation_from_swiftt">2.4. Calling a Repast Simphony simulation from Swift/T</h3>
<div class="paragraph">
<p>The full Swift/T script can be seen in <a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/main/code/uc1/swift/swiftrun.swift#L1" target="swiftrun.swift">swiftrun.swift</a>.
The scripts consists of defining variables from environment variables and user input:</p>
</div>
<div id="variables" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">string</span> <span class="tok-n">emews_root</span> <span class="tok-o">=</span> <span class="tok-n">getenv</span><span class="tok-p">(</span><span class="tok-s">&quot;EMEWS_PROJECT_ROOT&quot;</span><span class="tok-p">);</span>
<span class="tok-n">string</span> <span class="tok-n">turbine_output</span> <span class="tok-o">=</span> <span class="tok-n">getenv</span><span class="tok-p">(</span><span class="tok-s">&quot;TURBINE_OUTPUT&quot;</span><span class="tok-p">);</span>

<span class="tok-n">file</span> <span class="tok-n">model_sh</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-p">(</span><span class="tok-n">emews_root</span><span class="tok-o">+</span><span class="tok-s">&quot;/scripts/run_repast_uc1.sh&quot;</span><span class="tok-p">);</span>
<span class="tok-n">file</span> <span class="tok-n">upf</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">(</span><span class="tok-s">&quot;f&quot;</span><span class="tok-p">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and then defining four functions, one that calls the simulation, which is auto-generated by the EMEWS Creator <a href="#uc1-creator">command</a>:</p>
</div>
<div id="repast-app" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">app</span> <span class="tok-p">(</span><span class="tok-n">file</span> <span class="tok-n">out</span><span class="tok-p">,</span> <span class="tok-n">file</span> <span class="tok-n">err</span><span class="tok-p">)</span> <span class="tok-n">run_model</span><span class="tok-p">(</span><span class="tok-n">file</span> <span class="tok-n">shfile</span><span class="tok-p">,</span> <span class="tok-n">string</span> <span class="tok-n">param_line</span><span class="tok-p">,</span> <span class="tok-n">string</span> <span class="tok-n">instance</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
    <span class="tok-s">&quot;bash&quot;</span> <span class="tok-n">shfile</span> <span class="tok-n">param_line</span> <span class="tok-n">emews_root</span> <span class="tok-n">instance</span> <span class="tok-nd">@stdout</span><span class="tok-o">=</span><span class="tok-n">out</span> <span class="tok-nd">@stderr</span><span class="tok-o">=</span><span class="tok-n">err</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>two utility functions we create:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">app</span> <span class="tok-p">(</span><span class="tok-kt">void</span> <span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-n">make_dir</span><span class="tok-p">(</span><span class="tok-n">string</span> <span class="tok-n">dirname</span><span class="tok-p">)</span> <span class="tok-p">{</span>
  <span class="tok-s">&quot;mkdir&quot;</span> <span class="tok-s">&quot;-p&quot;</span> <span class="tok-n">dirname</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-n">app</span> <span class="tok-p">(</span><span class="tok-kt">void</span> <span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-n">run_prerequisites</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-s">&quot;cp&quot;</span> <span class="tok-p">(</span><span class="tok-n">emews_root</span><span class="tok-o">+</span><span class="tok-s">&quot;/complete_model/MessageCenter.log4j.properties&quot;</span><span class="tok-p">)</span> <span class="tok-n">turbine_output</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>followed by the code that performs the sweep, auto-generated, with the <code>run_prerequisites</code> block uncommented:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-n">run_prerequisites</span><span class="tok-p">()</span> <span class="tok-o">=&gt;</span> <span class="tok-p">{</span>
    <span class="tok-n">string</span> <span class="tok-n">upf_lines</span><span class="tok-o">[]</span> <span class="tok-o">=</span> <span class="tok-n">file_lines</span><span class="tok-p">(</span><span class="tok-n">upf</span><span class="tok-p">);</span>
    <span class="tok-n">foreach</span> <span class="tok-n">s</span><span class="tok-p">,</span><span class="tok-n">i</span> <span class="tok-n">in</span> <span class="tok-n">upf_lines</span> <span class="tok-p">{</span>
      <span class="tok-n">string</span> <span class="tok-n">instance</span> <span class="tok-o">=</span> <span class="tok-s">&quot;%s/instance_%i/&quot;</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">turbine_output</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">);</span>
      <span class="tok-n">make_dir</span><span class="tok-p">(</span><span class="tok-n">instance</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-p">{</span>
        <span class="tok-n">file</span> <span class="tok-n">out</span> <span class="tok-o">&lt;</span><span class="tok-n">instance</span><span class="tok-o">+</span><span class="tok-s">&quot;out.txt&quot;</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>
        <span class="tok-n">file</span> <span class="tok-n">err</span> <span class="tok-o">&lt;</span><span class="tok-n">instance</span><span class="tok-o">+</span><span class="tok-s">&quot;err.txt&quot;</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>
        <span class="tok-p">(</span><span class="tok-n">out</span><span class="tok-p">,</span><span class="tok-n">err</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">run_model</span><span class="tok-p">(</span><span class="tok-n">model_sh</span><span class="tok-p">,</span> <span class="tok-n">s</span><span class="tok-p">,</span> <span class="tok-n">instance</span><span class="tok-p">);</span>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_calling_the_external_application">2.4.1. Calling the External Application</h4>
<div class="paragraph">
<p>In order for Swift/T to call our external application (i.e., the Zombies model),
we define an
<mark><a href="#_external_execution">app</a></mark> function.
(The Zombies model is written in Java which is not easily called via Tcl and thus an app function is the best
choice for integrating the model into a Swift script. See the Swift/T Tutorial for more details.) Repast Simphony provides command line compatible functionality
via an InstanceRunner class, for passing a set of parameters to a model and performing a single headless
run of the model using those parameters. Using the InstanceRunner main class, Repast Simphony models can be launched by other
control applications such as a bash, PBS, or Swift scripts.  We have wrapped the command line invocation of
Repast Simphony&#8217;s InstanceRunner in a <mark>bash script</mark> <a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/main/code/uc1/scripts/repast.sh#L1" target="repast.sh">repast.sh</a>
 to ease command line usage.
Other non-Repast Simphony models or scientific applications with command line interfaces can be wrapped
and run similarly.</p>
</div>
<div class="paragraph">
<p>An annotated version of the Swift app function that calls Repast Simphony is shown <a href="#repast-app">below</a>.
Prior to the actual function definition, the environment variable
EMEWS_PROJECT_ROOT is accessed. This variable is used to define the project&#8217;s top level
directory, relative to which other directories (e.g., the directory
that contains the Zombies model) are defined. The value of the TURBINE_OUTPUT
environment variable is also retrieved. This specifies the path to
a directory where Swift/T stores its log files and which we will use
as a parent directory for the working directories of our individual runs.
For more on these variables see the
<mark><a href="#swift_run_sweep_sh">discussion</a></mark> in the template tutorial.</p>
</div>
<div id="repast-app-annot" class="listingblock">
<div class="title">Repast Simphony App Function</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">app</span> <span class="tok-p">(</span><span class="tok-n">file</span> <span class="tok-n">out</span><span class="tok-p">,</span> <span class="tok-n">file</span> <span class="tok-n">err</span><span class="tok-p">)</span> <span class="tok-n">run_model</span><span class="tok-p">(</span><span class="tok-n">file</span> <span class="tok-n">shfile</span><span class="tok-p">,</span> <span class="tok-n">string</span> <span class="tok-n">param_line</span><span class="tok-p">,</span> <span class="tok-n">string</span> <span class="tok-n">instance</span><span class="tok-p">)</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">{</span>
    <span class="tok-s">&quot;bash&quot;</span> <span class="tok-n">shfile</span> <span class="tok-n">param_line</span> <span class="tok-n">emews_root</span> <span class="tok-n">instance</span> <span class="tok-nd">@stdout</span><span class="tok-o">=</span><span class="tok-n">out</span> <span class="tok-nd">@stderr</span><span class="tok-o">=</span><span class="tok-n">err</span><span class="tok-p">;</span>  <i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The app function definition begins. The function returns two files, one for standard output and one for standard error.
The function arguments are those required to <mark>run</mark> <a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/main/code/uc1/scripts/repast.sh#L1" target="repast.sh">repast.sh</a>, that is,
the full path of the script, the parameters to run and the directory where the model run output should be written.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The body of the function calls the bash interpreter passing it the name of the script file to execute and the other function
arguments as well as the project root, that is, <code>emews_root</code> directory.
<code>@stdout=out</code> and <code>@stderr=err</code> redirect stdout and stderr to the files out and err.
It should be easy to see how any model or application that can be run from the command line
and wrapped in a bash script can be called from Swift in this way.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_utility_functions">2.4.2. Utility Functions</h4>
<div class="paragraph">
<p>As mentioned above, the Swift script also contains two utility app functions.</p>
</div>
<div id="util-app-annot" class="listingblock">
<div class="title">Utility Functions</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">app</span> <span class="tok-p">(</span><span class="tok-kt">void</span> <span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-n">make_dir</span><span class="tok-p">(</span><span class="tok-n">string</span> <span class="tok-n">dirname</span><span class="tok-p">)</span> <span class="tok-p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tok-s">&quot;mkdir&quot;</span> <span class="tok-s">&quot;-p&quot;</span> <span class="tok-n">dirname</span><span class="tok-p">;</span>
<span class="tok-p">}</span>

<span class="tok-n">app</span> <span class="tok-p">(</span><span class="tok-kt">void</span> <span class="tok-n">o</span><span class="tok-p">)</span> <span class="tok-n">run_prerequisites</span><span class="tok-p">()</span> <span class="tok-p">{</span>  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tok-s">&quot;cp&quot;</span> <span class="tok-p">(</span><span class="tok-n">emews_root</span><span class="tok-o">+</span><span class="tok-s">&quot;/complete_model/MessageCenter.log4j.properties&quot;</span><span class="tok-p">)</span> <span class="tok-n">turbine_output</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>make_dir</code> simply calls the Unix <code>mkdir</code> command to create a specified directory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>run_prerequisites</code> calls the unix <code>cp</code> command to copy a Repast Simphony logging configuration file into
the current working directory.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both of these are used by the parameter sweeping part of the script.</p>
</div>
</div>
<div class="sect3">
<h4 id="_parameter_sweeping">2.4.3. Parameter Sweeping</h4>
<div class="paragraph">
<p>The remainder of the Swift script performs a simple parameter sweep using the <code>run_model</code> app function to run the model.
The parameters over which we want to sweep are defined in an external file, the so-called unrolled parameter file (UPF),
where each row of the file contains a parameter set for an individual run. The script will read
these parameter sets and launch as many parallel runs as possible for a given process configuration,
passing each run an individual parameter set. The general script flow is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Read the the list of parameters into a <code>file</code> object.</p>
</li>
<li>
<p>Split the contents of the file into lines and store each as an array element.</p>
</li>
<li>
<p>Iterate over the array in parallel, launching a model run
for each parameter set (i.e., array element) in the array, using
the <code>run_model</code> app function.</p>
</li>
</ul>
</div>
<div id="sweep-annot" class="listingblock">
<div class="title">Parameters Sweep</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">string</span> <span class="tok-n">emews_root</span> <span class="tok-o">=</span> <span class="tok-n">getenv</span><span class="tok-p">(</span><span class="tok-s">&quot;EMEWS_PROJECT_ROOT&quot;</span><span class="tok-p">);</span>
<span class="tok-n">string</span> <span class="tok-n">turbine_output</span> <span class="tok-o">=</span> <span class="tok-n">getenv</span><span class="tok-p">(</span><span class="tok-s">&quot;TURBINE_OUTPUT&quot;</span><span class="tok-p">);</span>

<span class="tok-n">file</span> <span class="tok-n">model_sh</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-p">(</span><span class="tok-n">emews_root</span><span class="tok-o">+</span><span class="tok-s">&quot;/scripts/run_repast_uc1.sh&quot;</span><span class="tok-p">);</span>  <i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">file</span> <span class="tok-n">upf</span> <span class="tok-o">=</span> <span class="tok-n">input</span><span class="tok-p">(</span><span class="tok-n">argv</span><span class="tok-p">(</span><span class="tok-s">&quot;f&quot;</span><span class="tok-p">));</span>  <i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-n">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
  <span class="tok-n">run_prerequisites</span><span class="tok-p">()</span> <span class="tok-o">=&gt;</span> <span class="tok-p">{</span>  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="tok-n">string</span> <span class="tok-n">upf_lines</span><span class="tok-o">[]</span> <span class="tok-o">=</span> <span class="tok-n">file_lines</span><span class="tok-p">(</span><span class="tok-n">upf</span><span class="tok-p">);</span>  <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="tok-n">foreach</span> <span class="tok-n">s</span><span class="tok-p">,</span><span class="tok-n">i</span> <span class="tok-n">in</span> <span class="tok-n">upf_lines</span> <span class="tok-p">{</span>  <i class="conum" data-value="5"></i><b>(5)</b>
      <span class="tok-n">string</span> <span class="tok-n">instance</span> <span class="tok-o">=</span> <span class="tok-s">&quot;%s/instance_%i/&quot;</span> <span class="tok-o">%</span> <span class="tok-p">(</span><span class="tok-n">turbine_output</span><span class="tok-p">,</span> <span class="tok-n">i</span><span class="tok-o">+</span><span class="tok-mi">1</span><span class="tok-p">);</span>
      <span class="tok-n">make_dir</span><span class="tok-p">(</span><span class="tok-n">instance</span><span class="tok-p">)</span> <span class="tok-o">=&gt;</span> <span class="tok-p">{</span>  <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="tok-n">file</span> <span class="tok-n">out</span> <span class="tok-o">&lt;</span><span class="tok-n">instance</span><span class="tok-o">+</span><span class="tok-s">&quot;out.txt&quot;</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>
        <span class="tok-n">file</span> <span class="tok-n">err</span> <span class="tok-o">&lt;</span><span class="tok-n">instance</span><span class="tok-o">+</span><span class="tok-s">&quot;err.txt&quot;</span><span class="tok-o">&gt;</span><span class="tok-p">;</span>  <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="tok-p">(</span><span class="tok-n">out</span><span class="tok-p">,</span><span class="tok-n">err</span><span class="tok-p">)</span> <span class="tok-o">=</span> <span class="tok-n">run_model</span><span class="tok-p">(</span><span class="tok-n">model_sh</span><span class="tok-p">,</span> <span class="tok-n">s</span><span class="tok-p">,</span> <span class="tok-n">instance</span><span class="tok-p">);</span>  <i class="conum" data-value="8"></i><b>(8)</b>
      <span class="tok-p">}</span>
    <span class="tok-p">}</span>
  <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Initialize a Swift/T <code>file</code> variable with the location of the <code>run_repast_uc1.sh</code> script file. Note that the Swift/T <code>input</code>
function takes a path and returns a <code>file</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The path of the parameter file that contains
the parameter sets that will be passed as input to the Zombies model is defined, also as a <code>file</code> variable.
This line uses
the swift built-in function <code>argv</code> to parse command line arguments to the Swift script.
As indicated earlier, each line of this <code>upf</code> file contains an individual parameter set, that is,
the random_seed, zombie_count, human_count, zombie_step_size and human_step_size
for a single model run. The parameter set is passed as a single string
(e.g., random_seed = 14344, zombie_count = 10, &#8230;&#8203;)
to the Zombies model where it is parsed into the individual parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Script execution begins by calling the <code>run_prerequisites</code> app function.
In the absence of any data flow dependency, Swift statements will execute in parallel whenever possible.
However, in our case, the Repast Simphony logging configuration file must be in place before a Zombie model run begins.
The <code>&#8658;</code> symbol enforces the required sequential execution:
the code on its left-hand side must complete execution before the code on the right-hand side begins execution.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Read the <code>upf</code> file into an array of strings where each line of the file is an element in the array.
The built-in Swift <code>file_lines</code> function (requires import of files module at the <mark>top of</mark> <a href="https://github.com/jozik/emews_next_gen_tutorial_tests/blob/main/code/uc1/swift/swiftrun.swift#L3" target="swiftrun.swift">swiftrun.swift</a>)
is used to read the upf file into this array of strings.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>foreach</code> loop
executes its loop iterations in parallel. In the <code>foreach</code> loop, the variable <code>s</code> is set to an
array element (that is, a single parameter set represented as a string) while the variable <code>i</code> is the index of that array element.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Create an instance directory into which each model run will write its output. The <code>make_dir</code> app function
is used to create the directory. The <code>&#8658;</code> keyword is again used to ensure that the directory is created before the actual model
run that uses that directory is performed.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Create file objects into which the standard out and standard error streams are
redirected by the <a href="#repast-app-annot">run_model</a> function.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Lastly the <code>run_model</code> app function that performs the Zombie model run is called with the required arguments.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is a common pattern in EMEWS. Some collection of parameters is parsed into an array in which each element
is the set of parameters for an individual run. A foreach loop is then
used to iterate over the array, lauching parallel model runs each with
their own parameters. In this way the number of model runs that can be
performed in parallel is limited only by hardware resources.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-10-24 11:00:01 -0500
</div>
</div>
</body>
</html>